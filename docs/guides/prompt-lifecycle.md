# Plan/Agent Project Lifecycle

This guide treats each development task as a mini-project following the 5 PMBOK phases: Initiation → Planning → Execution → Monitoring & Controlling → Closing. DevEnvTemplate automates the heavy lifting while Cursor Plan mode becomes your primary development interface.

## Overview

**Goal:** Every development task becomes a precise, high-impact mini-project that delivers perfect codebase changes.

**How It Works:**
- **Zero Commands:** Drop DevEnvTemplate into any repo - CI handles everything
- **Plan-First:** Cursor Plan mode generates detailed, reviewable implementation plans
- **CI Automation:** Automated validation of plans, impact, and quality gates
- **Continuous Improvement:** Metrics tracking for process optimization

## What We Leverage

### From Cursor
- **Plan Mode:** AI-assisted plan generation and task breakdown
- **Inline Edits:** Multi-file changes with live diffs
- **Composer/Chat:** Rapid iteration and implementation

### From DevEnvTemplate (CI Automation)
- **Stack Intelligence:** Auto-detects your technology stack and gaps
- **Plan/Agent Guard:** Enforces Plan-first workflow
- **Quality Gates:** Linting, testing, security, performance validation
- **PR Integration:** Automated comments and validation status

## The 5-Phase Lifecycle

### Phase 1: Project Initiation (Problem Definition)

**Objective:** Define the task's scope, goals, and success criteria.

**Duration:** 5-15 minutes

**Artifacts Produced:**
- Context Contract (JSON file with requirements)
- Stakeholder identification
- Success metrics

**Steps:**

1. **Define the Problem Clearly**
   - What specific problem are you solving?
   - Who benefits and how?
   - What are the success criteria?
   - What constraints apply?

2. **Identify Stakeholders**
   - **Product Owner:** Approves requirements and success criteria
   - **Engineering Lead:** Reviews technical approach and risks
   - **QA Lead:** Defines acceptance test strategy
   - **Domain Experts:** Validate assumptions and constraints

**Success Criteria:**
- Problem is clearly defined and understood
- Success metrics are measurable
- Stakeholders are identified and engaged

---

### Phase 2: Project Planning (Plan Generation)

**Objective:** Create a detailed implementation plan with task breakdown, risks, and rollback strategy.

**Duration:** 15-45 minutes

**Artifacts Produced:**
- Implementation Plan (generated by Cursor Plan mode)
- Risk Assessment and mitigation plans

**Steps:**

1. **Drop DevEnvTemplate into Repository**
   - Copy `DevEnvTemplate/` folder into your project root
   - Push changes to trigger CI stack analysis

2. **Review CI Artifacts**
   - Download `.devenv/stack-report.json` from CI artifacts
   - Download `.devenv/gaps-report.md` from CI artifacts
   - Read CI PR comment with analysis findings

3. **Open Cursor Plan Mode**
   - Press `Cmd/Ctrl + Shift + P`
   - Select "Plan Mode"
   - Attach CI artifacts for comprehensive context

4. **Generate Detailed Plan**
   Use this Plan Mode template:
   ```
   ## Project Context (from CI Analysis)
   **Tech Stack:** [contents of .devenv/stack-report.json]
   **Current Gaps:** [relevant sections from .devenv/gaps-report.md]

   ## Task Requirements
   **Problem:** [Your specific problem definition]
   **Goals:** [Measurable success criteria]
   **Constraints:** [Technical/business limitations]

   ## Requirements
   - Follow DevEnvTemplate patterns from docs/engineering-handbook.md
   - Address gaps identified in CI analysis
   - Include comprehensive error handling and TypeScript types
   - Write tests for new functionality
   - Ensure code quality gates pass

   Create a detailed implementation plan with:
   1. Task breakdown (single-responsibility tasks)
   2. Specific file paths to modify/create
   3. Testing strategy
   4. Rollback plan
   5. Success metrics
   ```

5. **Create Plan-Only PR**
   - Use `.github/PULL_REQUEST_TEMPLATE/plan-only.md`
   - Include the Cursor Plan-generated plan
   - Get stakeholder approval on approach
   - Merge before proceeding to execution

**Success Criteria:**
- Plan addresses CI-identified gaps
- Specific file paths are identified
- Risk assessment includes mitigation strategies
- Plan-only PR approved (if `STRICT_PLAN_GUARD=true`)

---

### Phase 3: Project Execution (Implementation)

**Objective:** Implement the approved plan using Cursor with CI validation.

**Duration:** Variable (based on plan complexity)

**Artifacts Produced:**
- Feature branch with implemented changes
- Test coverage for new functionality

**Steps:**

1. **Implement Code with Cursor**
   - Use Cursor Composer/Chat to implement the plan
   - Follow the approved plan exactly
   - Include comprehensive error handling and TypeScript types
   - Write tests for new functionality

2. **Create Implementation PR**
   - Use `.github/PULL_REQUEST_TEMPLATE/implementation.md`
   - Reference the approved plan-only PR
   - Include testing notes and success criteria

3. **Address CI Feedback**
   - Review automated PR comments
   - Fix any validation issues
   - Ensure impact analysis alignment

**Success Criteria:**
- Code follows approved plan exactly
- All acceptance criteria from Phase 1 are met
- CI validation passes
- Tests cover new functionality

---

### Phase 4: Project Monitoring & Controlling (CI Validation)

**Objective:** Validate that execution matches the plan and meets quality standards.

**Duration:** CI automated (typically 5-15 minutes)

**Artifacts Produced:**
- CI annotations and PR comments
- Impact diff analysis
- Quality gate results

**Automated CI Checks:**

1. **Plan/Agent Guard**
   - Confirms approved plan-only PR exists (if `STRICT_PLAN_GUARD=true`)
   - Validates context contracts are complete

2. **Impact Validation**
   - Compares actual file changes vs plan predictions
   - Flags unexpected additions/removals
   - Ensures changes align with approved scope

3. **Quality Gates**
   - Linting and type checking
   - Unit and integration tests
   - Security and license scanning
   - Performance budget compliance

4. **PR Comment Summary**
   CI automatically posts a comment with:
   - ✅ Plan gate compliance
   - ✅ Impact validation results
   - ✅ Quality gate status
   - ⚠️ Any warnings or issues found

**Success Criteria:**
- All CI checks pass (or warnings acknowledged)
- Impact validation aligns with plan
- Quality gates meet standards
- Code successfully merged

---

### Phase 5: Project Closing (Lessons Learned)

**Objective:** Document lessons learned and improve the process for future tasks.

**Duration:** 5-10 minutes

**Artifacts Produced:**
- Session summary and lessons learned
- Process improvement insights

**Steps:**

1. **Complete Closeout Checklist**
   - [ ] All acceptance criteria from Phase 1 met
   - [ ] Code merged successfully
   - [ ] No post-merge issues discovered
   - [ ] Stakeholder feedback collected

2. **Document Session Summary**
   Create a summary covering:
   - Changes implemented and their impact
   - Challenges encountered and solutions
   - Process improvements identified
   - Tooling feedback (Cursor Plan mode, CI automation)

3. **Update Process Documentation**
   - Add new Plan mode snippets if patterns emerged
   - Update troubleshooting guides with new issues/solutions
   - Share learnings with the team

**Success Criteria:**
- Closeout checklist complete
- Lessons learned documented
- Process improvements identified
- Team knowledge updated

## Plan Mode Snippets

Ready-to-use Cursor Plan mode templates are available in `docs/snippets/plan-mode/`:

- **new-feature.md** - For implementing new functionality
- **improvement.md** - For enhancing existing code
- **refactor.md** - For restructuring without changing behavior
- **fix.md** - For bug fixes and corrections

## CI Configuration

Control enforcement through GitHub repository variables:

- `STRICT_PLAN_GUARD=true` - Require plan-only PRs for code changes
- `IMPACT_GUARD=warn|strict` - Impact validation level (warn or block)

## Benefits of This Approach

- **Zero Commands:** Drop folder, push, and Cursor handles everything
- **Plan-First:** Better requirements gathering and stakeholder alignment
- **CI Automation:** Automated validation prevents common issues
- **Continuous Improvement:** Process optimization through structured phases
- **Quality Assurance:** Multiple validation points ensure high standards

## Troubleshooting

**Problem:** CI doesn't detect stack properly
**Solution:** Ensure `package.json` exists with proper dependencies

**Problem:** Plan-only gate blocking implementation PR
**Solution:** Create and merge plan-only PR first, or disable `STRICT_PLAN_GUARD`

**Problem:** Impact validation shows unexpected changes
**Solution:** Update plan with additional affected files and explain rationale

**Problem:** Quality gates failing
**Solution:** Address linting, testing, or security issues before merge

This Plan/Agent lifecycle leverages DevEnvTemplate's automation while making Cursor Plan mode your primary development interface for structured, high-quality software development.
