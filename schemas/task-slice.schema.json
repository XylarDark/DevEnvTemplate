{
  "$schema": "https://json-schema.org/draft/2020-12/schema",
  "$id": "https://devenvtemplate.com/schemas/task-slice.schema.json",
  "title": "Task Slice",
  "description": "Schema for Task Slices that define small, self-contained development tasks with explicit boundaries to respect context limits.",
  "type": "object",
  "required": [
    "id",
    "contextContractId",
    "title",
    "description",
    "scope",
    "boundaries",
    "dependencies",
    "estimatedEffort",
    "acceptanceCriteria"
  ],
  "properties": {
    "id": {
      "type": "string",
      "description": "Unique identifier for this task slice (UUID format preferred)",
      "pattern": "^[a-f0-9]{8}-[a-f0-9]{4}-[a-f0-9]{4}-[a-f0-9]{4}-[a-f0-9]{12}$"
    },
    "contextContractId": {
      "type": "string",
      "description": "Reference to the parent context contract",
      "pattern": "^[a-f0-9]{8}-[a-f0-9]{4}-[a-f0-9]{4}-[a-f0-9]{4}-[a-f0-9]{12}$"
    },
    "version": {
      "type": "string",
      "description": "Version of this task slice",
      "pattern": "^\\d+\\.\\d+\\.\\d+$",
      "default": "1.0.0"
    },
    "title": {
      "type": "string",
      "description": "Clear, actionable title (under 80 characters)",
      "maxLength": 80
    },
    "description": {
      "type": "string",
      "description": "Detailed description of what this task accomplishes"
    },
    "scope": {
      "type": "object",
      "description": "What is included in this task slice",
      "required": ["inScope", "outOfScope"],
      "properties": {
        "inScope": {
          "type": "array",
          "description": "What is explicitly included",
          "minItems": 1,
          "items": {
            "type": "string",
            "description": "Scope item"
          }
        },
        "outOfScope": {
          "type": "array",
          "description": "What is explicitly NOT included",
          "items": {
            "type": "string",
            "description": "Out of scope item"
          }
        }
      }
    },
    "boundaries": {
      "type": "object",
      "description": "Technical and organizational boundaries",
      "required": ["technical", "organizational"],
      "properties": {
        "technical": {
          "type": "object",
          "description": "Technical constraints and boundaries",
          "properties": {
            "files": {
              "type": "array",
              "description": "Specific files/modules this task may touch",
              "items": {
                "type": "string",
                "description": "File path or pattern"
              }
            },
            "apis": {
              "type": "array",
              "description": "APIs this task may call",
              "items": {
                "type": "string",
                "description": "API endpoint or service"
              }
            },
            "data": {
              "type": "array",
              "description": "Data structures this task may modify",
              "items": {
                "type": "string",
                "description": "Data structure or schema"
              }
            },
            "constraints": {
              "type": "array",
              "description": "Technical constraints",
              "items": {
                "type": "string",
                "description": "Constraint description"
              }
            }
          }
        },
        "organizational": {
          "type": "object",
          "description": "Team and process boundaries",
          "properties": {
            "team": {
              "type": "string",
              "description": "Which team owns this task"
            },
            "reviewers": {
              "type": "array",
              "description": "Required reviewers",
              "items": {
                "type": "string",
                "description": "Reviewer name or role"
              }
            },
            "stakeholders": {
              "type": "array",
              "description": "Stakeholders to notify",
              "items": {
                "type": "string",
                "description": "Stakeholder name"
              }
            }
          }
        }
      }
    },
    "dependencies": {
      "type": "object",
      "description": "Dependencies required before this task can start",
      "properties": {
        "prerequisites": {
          "type": "array",
          "description": "Tasks that must be completed first",
          "items": {
            "type": "string",
            "description": "Prerequisite task ID or description"
          }
        },
        "external": {
          "type": "array",
          "description": "External dependencies (APIs, services, etc.)",
          "items": {
            "type": "object",
            "required": ["description", "status"],
            "properties": {
              "description": {
                "type": "string",
                "description": "Dependency description"
              },
              "status": {
                "type": "string",
                "enum": ["available", "pending", "blocked"],
                "description": "Current availability status"
              },
              "owner": {
                "type": "string",
                "description": "Who to contact for this dependency"
              }
            }
          }
        },
        "assumptions": {
          "type": "array",
          "description": "Assumptions that must be validated",
          "items": {
            "type": "string",
            "description": "Assumption reference or description"
          }
        }
      }
    },
    "estimatedEffort": {
      "type": "object",
      "description": "Effort estimation for planning",
      "required": ["hours", "confidence", "basis"],
      "properties": {
        "hours": {
          "type": "number",
          "description": "Estimated hours of work",
          "minimum": 0.25,
          "maximum": 40
        },
        "confidence": {
          "type": "string",
          "enum": ["high", "medium", "low"],
          "description": "Confidence level in estimate"
        },
        "basis": {
          "type": "string",
          "description": "What the estimate is based on"
        },
        "risks": {
          "type": "array",
          "description": "Factors that could affect the estimate",
          "items": {
            "type": "string",
            "description": "Risk description"
          }
        }
      }
    },
    "acceptanceCriteria": {
      "type": "array",
      "description": "Concrete criteria that must be met for completion",
      "minItems": 1,
      "items": {
        "type": "object",
        "required": ["description", "type", "priority"],
        "properties": {
          "description": {
            "type": "string",
            "description": "Specific acceptance criterion"
          },
          "type": {
            "type": "string",
            "enum": ["functional", "performance", "security", "accessibility", "usability", "compatibility"],
            "description": "Type of criterion"
          },
          "priority": {
            "type": "string",
            "enum": ["must", "should", "could"],
            "description": "MoSCoW priority"
          },
          "verification": {
            "type": "string",
            "description": "How to verify this criterion"
          }
        }
      }
    },
    "contextRequirements": {
      "type": "object",
      "description": "Context needed for implementation",
      "properties": {
        "files": {
          "type": "array",
          "description": "Files that must be included in context",
          "items": {
            "type": "string",
            "description": "File path or pattern"
          }
        },
        "specs": {
          "type": "array",
          "description": "Specifications that must be referenced",
          "items": {
            "type": "string",
            "description": "Spec file or section reference"
          }
        },
        "examples": {
          "type": "array",
          "description": "Examples or patterns to follow",
          "items": {
            "type": "string",
            "description": "Example reference"
          }
        },
        "maxSizeKB": {
          "type": "number",
          "description": "Maximum context pack size in KB",
          "default": 500,
          "minimum": 1,
          "maximum": 2000
        }
      }
    },
    "testing": {
      "type": "object",
      "description": "Testing requirements and strategy",
      "properties": {
        "strategy": {
          "type": "string",
          "description": "Testing approach and philosophy"
        },
        "types": {
          "type": "array",
          "description": "Required test types",
          "items": {
            "type": "string",
            "enum": ["unit", "integration", "e2e", "manual", "performance", "security"]
          }
        },
        "coverage": {
          "type": "object",
          "description": "Coverage requirements",
          "properties": {
            "minimum": {
              "type": "number",
              "description": "Minimum coverage percentage",
              "minimum": 0,
              "maximum": 100
            },
            "target": {
              "type": "number",
              "description": "Target coverage percentage",
              "minimum": 0,
              "maximum": 100
            }
          }
        }
      }
    },
    "rollback": {
      "type": "object",
      "description": "Rollback strategy if deployment fails",
      "properties": {
        "strategy": {
          "type": "string",
          "description": "How to safely rollback this change"
        },
        "automated": {
          "type": "boolean",
          "description": "Whether rollback can be automated",
          "default": true
        },
        "risks": {
          "type": "array",
          "description": "Risks associated with rollback",
          "items": {
            "type": "string",
            "description": "Risk description"
          }
        }
      }
    },
    "created": {
      "type": "string",
      "description": "ISO 8601 timestamp when this task slice was created",
      "format": "date-time"
    },
    "updated": {
      "type": "string",
      "description": "ISO 8601 timestamp when this task slice was last updated",
      "format": "date-time"
    },
    "author": {
      "type": "string",
      "description": "Person who authored this task slice"
    },
    "status": {
      "type": "string",
      "enum": ["draft", "ready", "in-progress", "completed", "cancelled"],
      "description": "Current status of this task slice",
      "default": "draft"
    }
  }
}
